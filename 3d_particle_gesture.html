
         <!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>3D æ‰‹åŠ¿ç²’å­äº¤äº’ï¼ˆå›½å†…ç‰ˆï¼‰</title>

<!-- ========== å›½å†… CDNï¼ˆéå¸¸é‡è¦ï¼‰ ========== -->
<script src="https://fastly.jsdelivr.net/npm/three@0.157.0/build/three.min.js"></script>
<script src="https://fastly.jsdelivr.net/npm/three@0.157.0/examples/js/controls/OrbitControls.js"></script>
<script src="https://fastly.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>

<!-- MediaPipeï¼ˆå›½å†…å¯è®¿é—®é•œåƒï¼‰ -->
<script src="https://fastly.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://fastly.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
<script src="https://fastly.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>

<style>
body {
    margin: 0; overflow: hidden;
    background: #000;
    font-family: "Microsoft Yahei", sans-serif;
}

/* å·¦ä¸Šè§’çŠ¶æ€æ˜¾ç¤º */
#statusBox {
    position: fixed;
    left: 15px; top: 15px;
    color: #fff; font-size: 17px;
}

/* ä¸­é—´åŠ è½½æ¡† */
#loadingBox {
    position: fixed;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    padding: 40px;
    background: rgba(0,0,0,0.6);
    color: #fff;
    border-radius: 20px;
    text-align: center;
    font-size: 28px;
}

/* UI æ§åˆ¶é¢æ¿ */
#uiPanel {
    position: fixed;
    bottom: 0; left: 0;
    width: 100%;
    background: rgba(20,20,20,0.9);
    backdrop-filter: blur(10px);
    padding: 12px 10px;
    display: flex;
    justify-content: space-around;
    align-items: center;
}

.ui-btn {
    color: #fff; background: #333;
    padding: 10px 18px;
    border-radius: 12px;
    font-size: 22px; border: 2px solid #666;
}

/* å…¨å±æŒ‰é’® */
#fullscreenBtn {
    position: fixed;
    top: 12px; right: 12px;
    background: rgba(255,255,255,0.2);
    padding: 10px 18px;
    border-radius: 10px; color: #fff;
    font-size: 20px;
}
</style>
</head>

<body>
<div id="statusBox">ğŸ”´ æ‘„åƒå¤´æœªè¿æ¥</div>
<div id="loadingBox">ç³»ç»Ÿåˆå§‹åŒ–ä¸­â€¦<br>æ­£åœ¨åŠ è½½ AI æ‰‹åŠ¿æ¨¡å‹</div>
<div id="fullscreenBtn">â›¶ å…¨å±</div>

<div id="uiPanel">
    <button class="ui-btn" onclick="setShape('heart')">â¤ï¸ çˆ±å¿ƒ</button>
    <button class="ui-btn" onclick="setShape('flower')">ğŸŒ¸ èŠ±æœµ</button>
    <button class="ui-btn" onclick="setShape('planet')">ğŸª åœŸæ˜Ÿ</button>
    <button class="ui-btn" onclick="setShape('buddha')">ğŸ§˜ ä½›åƒ</button>
    <button class="ui-btn" onclick="setShape('firework')">ğŸ† çƒŸèŠ±</button>

    <input type="color" id="colorPicker" />
</div>

<script>
// ========== Three.js åŸºç¡€ ==========
let scene = new THREE.Scene();
let camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.set(0,0,120);

let renderer = new THREE.WebGLRenderer({ antialias:true });
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// æ§åˆ¶å™¨
let controls = new THREE.OrbitControls(camera, renderer.domElement);
controls.enableDamping = true;

// ========== ç²’å­ç³»ç»Ÿ ==========
let particleCount = 12000;
let positions = new Float32Array(particleCount * 3);
let targetPositions = new Float32Array(particleCount * 3);

let geometry = new THREE.BufferGeometry();
geometry.setAttribute("position", new THREE.BufferAttribute(positions, 3));

let material = new THREE.PointsMaterial({
    color: 0xffffff,
    size: 0.8
});

let particles = new THREE.Points(geometry, material);
scene.add(particles);

// ========== ç”Ÿæˆå›¾å½¢ ==========
function fill(target, fx, fy, fz) {
    for (let i = 0; i < particleCount; i++) {
        target[i*3]   = fx(i);
        target[i*3+1] = fy(i);
        target[i*3+2] = fz(i);
    }
}

function setShape(type) {
    if (type === "heart") {
        fill(targetPositions, i=>{
            let t = Math.random()*2*Math.PI;
            let x = 16*Math.pow(Math.sin(t),3);
            let y = -(13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t));
            return x*2;
        }, i=>{
            let t = Math.random()*2*Math.PI;
            return -(13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t))*2;
        }, i=> (Math.random()*2 -1)*2 );
    }

    else if (type === "planet") {
        fill(targetPositions,
            i=> 30*Math.cos(i)*Math.random(),
            i=> 30*Math.sin(i)*Math.random(),
            i=> (Math.random()*4 -2));
    }

    else if (type === "firework") {
        for (let i=0;i<particleCount;i++){
            targetPositions[i*3] = (Math.random()*2-1)*50;
            targetPositions[i*3+1] = (Math.random()*2-1)*50;
            targetPositions[i*3+2] = (Math.random()*2-1)*50;
        }
    }
}

setShape("heart");

// ========== é«˜çº§åŠŸèƒ½ï¼šç²’å­å‘¼å¸å¾‹åŠ¨ ==========
let t = 0;

// ========== MediaPipe æ‰‹åŠ¿ ==========
const video = document.createElement("video");
video.style.display = "none";
document.body.appendChild(video);

let hands = new Hands({
    locateFile: file => `https://fastly.jsdelivr.net/npm/@mediapipe/hands/${file}`
});
hands.setOptions({
    maxNumHands: 2,
    modelComplexity: 1,
    minDetectionConfidence: 0.5,
    minTrackingConfidence: 0.5
});

hands.onResults(results=>{
    document.getElementById("statusBox").innerHTML = "ğŸŸ¢ æ‘„åƒå¤´å·²è¿æ¥";

    let factor = 0;

    if (results.multiHandLandmarks?.length>0){
        let hand = results.multiHandLandmarks[0];
        let pinch =
            Math.hypot(
                hand[4].x - hand[8].x,
                hand[4].y - hand[8].y
            );

        factor = Math.min(1, pinch*4); // æ‰‹è¶Šå¼€ç²’å­è¶Šæ•£
    }

    interactionFactor = factor;
});

const cameraFeed = new Camera(video,{
    onFrame: async ()=>{
        await hands.send({image: video});
    },
    width: 640, height: 480
});
cameraFeed.start();

// ========== æ¸²æŸ“å¾ªç¯ ==========
let interactionFactor = 0;

function animate(){
    requestAnimationFrame(animate);
    controls.update();
    t += 0.01;

    let pos = geometry.attributes.position.array;

    for (let i=0;i<particleCount;i++){
        let ix = i*3;

        let original = targetPositions[ix];
        let breathe = Math.sin(t*2 + i*0.01) * 1.2;

        pos[ix]     += (original - pos[ix])     * (0.05 + interactionFactor*0.1) + breathe;
        pos[ix+1]   += (targetPositions[ix+1] - pos[ix+1])*(0.05 + interactionFactor*0.1) + breathe;
        pos[ix+2]   += (targetPositions[ix+2] - pos[ix+2])*(0.05 + interactionFactor*0.1);
    }

    geometry.attributes.position.needsUpdate = true;
    renderer.render(scene, camera);
}

animate();

// ========== å…¨å± ==========
document.getElementById("fullscreenBtn").onclick=()=>{
    document.documentElement.requestFullscreen();
};

// ========== ä¿®æ”¹é¢œè‰² ==========
document.getElementById("colorPicker").oninput=e=>{
    material.color.set(e.target.value);
};
</script>
</body>
</html>
